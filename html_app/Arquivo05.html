<script>
  function deslogar() {
    if (!confirm("Tem certeza que deseja sair?\nTudo ser√° apagado.")) return;

    sessaoAtiva = false;
    clearTimeout(inatividadeTimer);

    ['prompt', 'arquivo', 'enviar', 'remover', 'ferramenta', 'grafico_tipo', 'coluna_y', 'colunas_x'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.disabled = true;
        el.value = '';
      }
    });

    if (slimSelectInstance) {
      slimSelectInstance.destroy();
      slimSelectInstance = null;
    }

    document.getElementById('analise').innerHTML = '';
    document.getElementById('grafico').innerHTML = '';
    document.getElementById('erro-arquivo').textContent = '';

    const msg = document.getElementById('mensagem-chave');
    msg.textContent = 'üëã At√© a pr√≥xima!';
    msg.style.color = 'gray';
    setTimeout(() => { msg.textContent = ''; }, 2000);

    const campoSenha = document.getElementById('chave');
    const btnValidar = document.getElementById('validar');
    campoSenha.required = true;
    campoSenha.disabled = false;
    campoSenha.value = '';
    btnValidar.disabled = false;
    btnValidar.textContent = 'Validar';

    document.getElementById('sair').style.display = 'none';
  }

  function limparMensagensAnteriores() {
    const mensagensErro = document.querySelectorAll(".erro-aviso, .alerta, .mensagem-erro, .falha");
    mensagensErro.forEach(msg => msg.remove());

    const msgErroFetch = document.getElementById("mensagem-erro-fetch");
    if (msgErroFetch) msgErroFetch.remove();
  }

  const form = document.querySelector("form");
  if (form) {
    form.addEventListener("submit", function (event) {
      const valido = validarCamposSelecionados();
      if (!valido) {
        event.preventDefault();
        return;
      }
      limparMensagensAnteriores(); // S√≥ limpa se passar na valida√ß√£o
    });
  }

  function exibirModalErro(mensagem) {
    let modal = document.getElementById("modal-erro");

    if (!modal) {
      modal = document.createElement("div");
      modal.id = "modal-erro";
      modal.style.position = "fixed";
      modal.style.top = "0";
      modal.style.left = "0";
      modal.style.width = "100%";
      modal.style.height = "100%";
      modal.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
      modal.style.display = "flex";
      modal.style.justifyContent = "center";
      modal.style.alignItems = "center";
      modal.style.zIndex = "1000";

      const caixa = document.createElement("div");
      caixa.style.backgroundColor = "white";
      caixa.style.padding = "20px";
      caixa.style.borderRadius = "8px";
      caixa.style.maxWidth = "400px";
      caixa.style.textAlign = "center";
      caixa.innerHTML = `
        <p id="modal-erro-texto" style="margin-bottom: 16px; font-size: 16px;"></p>
        <button onclick="fecharModalErro()" style="padding: 6px 12px;">OK</button>
      `;

      modal.appendChild(caixa);
      document.body.appendChild(modal);
    }

    document.getElementById("modal-erro-texto").textContent = mensagem;
    modal.style.display = "flex";
  }

  function fecharModalErro() {
    const modal = document.getElementById("modal-erro");
    if (modal) modal.style.display = "none";
  }
</script>







